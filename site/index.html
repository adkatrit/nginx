<!doctype html>
<html lang="en" data-theme="neo">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#070a18" />
    <title>MySongs Player</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NRQ96GQ70K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NRQ96GQ70K');
    </script>
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="alternate icon" href="./favicon.svg" />
    <link rel="stylesheet" href="./styles.css" />
    <script type="importmap">
      {
        "imports": {
          "three": "https://ga.jspm.io/npm:three@0.160.0/build/three.module.js"
        }
      }
    </script>
  </head>
  <body>
    <noscript>
      <div class="noscript">
        This site needs JavaScript enabled to play audio.
      </div>
    </noscript>

    <!-- Full-screen background visualization -->
    <canvas id="bgViz" class="immersive-bg-viz" aria-hidden="true"></canvas>

    <!-- Screen reader announcements -->
    <div class="sr-only" role="status" aria-live="polite" id="ariaStatus"></div>

    <main id="app" class="immersive-app" aria-label="MySongs Player">

      <!-- Floating Control Bar -->
      <div class="control-bar" id="controlBar" role="region" aria-label="Playback controls">

        <!-- Track Info -->
        <div class="control-bar__track">
          <div class="control-bar__cover" id="nowPlayingCover" aria-hidden="true"></div>
          <div class="control-bar__info">
            <div class="control-bar__title" id="trackTitle">No tracks loaded</div>
            <div class="control-bar__artist" id="trackArtist"></div>
          </div>
        </div>

        <!-- Main Controls -->
        <div class="control-bar__main">
          <div class="control-bar__buttons">
            <button class="ctrl-btn ctrl-btn--sm" id="shuffleBtn" type="button" aria-label="Toggle shuffle" aria-pressed="false" title="Shuffle">
              &#x21C4;
            </button>
            <button class="ctrl-btn" id="prevBtn" type="button" aria-label="Previous track" title="Previous">
              &#x23EE;
            </button>
            <button class="ctrl-btn ctrl-btn--play" id="playPauseBtn" type="button" aria-label="Play" title="Play/Pause">
              &#x25B6;
            </button>
            <button class="ctrl-btn" id="nextBtn" type="button" aria-label="Next track" title="Next">
              &#x23ED;
            </button>
            <button class="ctrl-btn ctrl-btn--sm" id="repeatBtn" type="button" aria-label="Toggle repeat" aria-pressed="false" title="Repeat">
              &#x1F501;
            </button>
          </div>

          <div class="control-bar__seek">
            <span class="control-bar__time" id="currentTime">0:00</span>
            <input id="seek" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek position" />
            <span class="control-bar__time" id="duration">0:00</span>
          </div>
        </div>

        <!-- Right Section -->
        <div class="control-bar__right">
          <div class="control-bar__volume">
            <button class="ctrl-btn ctrl-btn--sm" id="volumeBtn" type="button" aria-label="Mute" title="Volume">
              &#x1F50A;
            </button>
            <input id="volume" type="range" min="0" max="100" value="100" step="1" class="volume-slider" aria-label="Volume" />
          </div>

          <select id="vizSelect" class="select-mini" aria-label="Visualizer mode">
            <option value="grid">Grid</option>
            <option value="nebula">Nebula</option>
            <option value="scope">Scope</option>
            <option value="voyage">Voyage</option>
            <option value="off">Off</option>
          </select>

          <select id="themeSelect" class="select-mini" aria-label="Theme">
            <option value="neo">Neo</option>
            <option value="midnight">Midnight</option>
            <option value="winamp41">Classic</option>
          </select>

          <button class="ctrl-btn ctrl-btn--sm" id="vizSettingsBtn" type="button" aria-label="Visualizer settings" aria-expanded="false" title="Viz Settings">
            &#x2699;
          </button>

          <button class="ctrl-btn ctrl-btn--playlist" id="playlistBtn" type="button" aria-label="Open playlist" aria-expanded="false" title="Library">
            &#x2630;
          </button>
        </div>
      </div>

      <!-- Visualizer Settings Panel -->
      <div class="viz-settings" id="vizSettings" hidden>
        <div class="viz-settings__header">
          <span class="viz-settings__title">Visualizer</span>
          <button class="viz-settings__close" id="closeVizSettings" type="button" aria-label="Close settings">&#x2715;</button>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Amplitude</span>
            <span class="viz-settings__value" id="amplitudeValue">30%</span>
          </label>
          <input type="range" id="vizAmplitude" min="20" max="300" value="30" step="10" class="viz-settings__slider" />
          <div class="viz-settings__hint">How much the audio moves the visualization</div>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Smoothing</span>
            <span class="viz-settings__value" id="smoothingValue">15%</span>
          </label>
          <input type="range" id="vizSmoothing" min="0" max="95" value="15" step="1" class="viz-settings__slider" />
          <div class="viz-settings__hint">Lower = snappier, higher = smoother</div>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Speed</span>
            <span class="viz-settings__value" id="speedValue">200%</span>
          </label>
          <input type="range" id="vizSpeed" min="25" max="200" value="200" step="5" class="viz-settings__slider" />
          <div class="viz-settings__hint">Base animation and rotation speed</div>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Audio Reactivity</span>
            <span class="viz-settings__value" id="reactivityValue">100%</span>
          </label>
          <input type="range" id="vizReactivity" min="0" max="100" value="100" step="5" class="viz-settings__slider" />
          <div class="viz-settings__hint">How much audio affects speed (0% = static, 100% = fully reactive)</div>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Camera Zoom</span>
            <span class="viz-settings__value" id="zoomValue">25%</span>
          </label>
          <input type="range" id="vizZoom" min="25" max="200" value="25" step="5" class="viz-settings__slider" />
          <div class="viz-settings__hint">Camera distance from visualization</div>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>3D Model</span>
          </label>
          <select id="modelSelect" class="viz-settings__select">
            <option value="">None</option>
          </select>
          <div class="viz-settings__hint">Add GLTF/GLB models to ./models/ folder</div>
        </div>
        <div class="viz-settings__group viz-settings__group--model" id="modelSettingsGroup" hidden>
          <label class="viz-settings__label">
            <span>Model Scale</span>
            <span class="viz-settings__value" id="modelScaleValue">1.0</span>
          </label>
          <input type="range" id="modelScale" min="0.1" max="5" value="1" step="0.1" class="viz-settings__slider" />
        </div>
        <div class="viz-settings__group viz-settings__group--model" id="modelPosYGroup" hidden>
          <label class="viz-settings__label">
            <span>Model Y Position</span>
            <span class="viz-settings__value" id="modelPosYValue">0</span>
          </label>
          <input type="range" id="modelPosY" min="-5" max="5" value="0" step="0.1" class="viz-settings__slider" />
        </div>
        <div class="viz-settings__group viz-settings__group--model" id="modelRotYGroup" hidden>
          <label class="viz-settings__label">
            <span>Model Rotation</span>
            <span class="viz-settings__value" id="modelRotYValue">0Â°</span>
          </label>
          <input type="range" id="modelRotY" min="0" max="360" value="0" step="5" class="viz-settings__slider" />
        </div>
        <div class="viz-settings__group viz-settings__group--model" id="modelAnimSpeedGroup" hidden>
          <label class="viz-settings__label">
            <span>Animation Speed</span>
            <span class="viz-settings__value" id="modelAnimSpeedValue">1.0x</span>
          </label>
          <input type="range" id="modelAnimSpeed" min="0" max="3" value="1" step="0.1" class="viz-settings__slider" />
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Scale Pulse</span>
          </label>
          <label class="viz-settings__checkbox">
            <input type="checkbox" id="scalePulseEnabled" checked />
            <span>React to bass</span>
          </label>
        </div>
        <div class="viz-settings__tip">
          <strong>Tip:</strong> Click and drag on the visualization to rotate the camera. Scroll to zoom. Right-click and drag to pan.
        </div>
        <div class="viz-settings__buttons">
          <button class="viz-settings__btn viz-settings__btn--copy" id="copySettingsBtn" type="button">Copy Settings JSON</button>
          <button class="viz-settings__btn viz-settings__btn--reset" id="resetVizSettings" type="button">Reset to Default</button>
        </div>
      </div>

      <!-- Playlist Modal -->
      <div class="playlist-modal" id="playlistModal" role="dialog" aria-modal="true" aria-labelledby="playlistModalTitle" hidden>
        <div class="playlist-modal__backdrop" id="playlistBackdrop"></div>
        <div class="playlist-modal__content">
          <header class="playlist-modal__header">
            <h2 id="playlistModalTitle" class="playlist-modal__title">Library</h2>
            <div class="playlist-modal__actions">
              <button class="modal-btn" id="addBtn" type="button">ADD</button>
              <button class="modal-btn modal-btn--danger" id="clearBtn" type="button">CLR</button>
            </div>
            <button class="playlist-modal__close" id="closePlaylistBtn" type="button" aria-label="Close playlist">
              &#x2715;
            </button>
          </header>

          <div class="playlist-modal__search">
            <input id="filterInput" type="search" placeholder="Search tracks..." autocomplete="off" aria-label="Search tracks" />
            <input id="filePicker" type="file" accept="audio/*,.mp3,.wav,.ogg,.m4a,.aac,.flac" multiple hidden />
          </div>

          <ol class="playlist-modal__list wa-list" id="playlist" aria-label="Track list"></ol>

          <div class="playlist-modal__empty" id="emptyState">
            <div class="empty-icon">&#x266B;</div>
            <div class="empty-title">No tracks yet</div>
            <div class="empty-text">
              Drag audio files here, click ADD, or add tracks to <code>tracks.js</code>
            </div>
          </div>

          <div class="playlist-modal__dropzone" id="dropzone" aria-hidden="true">
            Drop audio files to add
          </div>
        </div>
      </div>

    </main>

    <!-- Keep a real media element in the DOM for best mobile behavior -->
    <audio id="playerAudio" preload="metadata" crossorigin="anonymous" playsinline style="display:none"></audio>

    <script src="./tracks.js"></script>
    <script src="./models.js"></script>
    <script src="./themes.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
