<!doctype html>
<html lang="en" data-theme="neo">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#070a18" />
    <title>Audio Environments</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NRQ96GQ70K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NRQ96GQ70K');
    </script>
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="alternate icon" href="./favicon.svg" />
    <link rel="stylesheet" href="./styles.css" />
    <script type="importmap">
      {
        "imports": {
          "three": "https://ga.jspm.io/npm:three@0.160.0/build/three.module.js"
        }
      }
    </script>
  </head>
  <body>
    <noscript>
      <div class="noscript">
        This site needs JavaScript enabled to play audio.
      </div>
    </noscript>

    <!-- Full-screen background visualization -->
    <canvas id="bgViz" class="immersive-bg-viz" aria-hidden="true"></canvas>

    <!-- Score HUD overlay -->
    <div id="scoreHud" class="score-hud" aria-hidden="true">
      <div class="score-display">
        <span class="score-label">SCORE</span>
        <span class="score-value" id="scoreValue">0</span>
      </div>
      <div class="combo-display" id="comboDisplay">
        <span class="combo-value" id="comboValue">1</span>
        <span class="combo-label">x COMBO</span>
      </div>
      <div class="high-score-display">
        <span class="high-score-label">HIGH</span>
        <span class="high-score-value" id="highScoreValue">0</span>
      </div>
    </div>

    <!-- Hit feedback overlay -->
    <div id="hitFeedback" class="hit-feedback" aria-hidden="true"></div>

    <!-- High Score Entry Modal -->
    <div id="highScoreModal" class="high-score-modal" hidden>
      <div class="high-score-modal__content">
        <h2 class="high-score-modal__title">NEW HIGH SCORE!</h2>
        <div class="high-score-modal__score" id="finalScoreDisplay">0</div>
        <div class="high-score-modal__track" id="finalTrackDisplay"></div>
        <div class="high-score-modal__input">
          <label>Enter your initials:</label>
          <input type="text" id="initialsInput" maxlength="3" placeholder="AAA" autocomplete="off" />
        </div>
        <div class="high-score-modal__buttons">
          <button id="saveScoreBtn" class="high-score-modal__btn">SAVE</button>
          <button id="skipScoreBtn" class="high-score-modal__btn high-score-modal__btn--skip">SKIP</button>
        </div>
        <div class="high-score-modal__leaderboard" id="leaderboardDisplay"></div>
      </div>
    </div>

    <!-- Screen reader announcements -->
    <div class="sr-only" role="status" aria-live="polite" id="ariaStatus"></div>

    <main id="app" class="immersive-app" aria-label="Audio Player">

      <!-- Floating Control Bar -->
      <div class="control-bar" id="controlBar" role="region" aria-label="Playback controls">

        <!-- Track Info -->
        <div class="control-bar__track">
          <div class="control-bar__cover" id="nowPlayingCover" aria-hidden="true"></div>
          <div class="control-bar__info">
            <div class="control-bar__title" id="trackTitle">No tracks loaded</div>
            <div class="control-bar__artist" id="trackArtist"></div>
          </div>
        </div>

        <!-- Main Controls -->
        <div class="control-bar__main">
          <div class="control-bar__buttons">
            <button class="ctrl-btn ctrl-btn--sm" id="shuffleBtn" type="button" aria-label="Toggle shuffle" aria-pressed="false" title="Shuffle">
              &#x21C4;
            </button>
            <button class="ctrl-btn" id="prevBtn" type="button" aria-label="Previous track" title="Previous">
              &#x23EE;
            </button>
            <button class="ctrl-btn ctrl-btn--play" id="playPauseBtn" type="button" aria-label="Play" title="Play/Pause">
              &#x25B6;
            </button>
            <button class="ctrl-btn" id="nextBtn" type="button" aria-label="Next track" title="Next">
              &#x23ED;
            </button>
            <button class="ctrl-btn ctrl-btn--sm" id="repeatBtn" type="button" aria-label="Toggle repeat" aria-pressed="false" title="Repeat">
              &#x1F501;
            </button>
          </div>

          <div class="control-bar__seek">
            <span class="control-bar__time" id="currentTime">0:00</span>
            <input id="seek" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek position" />
            <span class="control-bar__time" id="duration">0:00</span>
          </div>
        </div>

        <!-- Right Section -->
        <div class="control-bar__right">
          <div class="control-bar__volume">
            <button class="ctrl-btn ctrl-btn--sm" id="volumeBtn" type="button" aria-label="Mute" title="Volume">
              &#x1F50A;
            </button>
            <input id="volume" type="range" min="0" max="100" value="100" step="1" class="volume-slider" aria-label="Volume" />
          </div>

          <button class="ctrl-btn ctrl-btn--sm" id="vizSettingsBtn" type="button" aria-label="Visualization settings" aria-expanded="false" title="Settings">
            &#x2699;
          </button>

          <button class="ctrl-btn ctrl-btn--playlist" id="playlistBtn" type="button" aria-label="Open playlist" aria-expanded="false" title="Library">
            &#x2630;
          </button>
        </div>
      </div>

      <!-- Visualization Settings Panel -->
      <div class="viz-settings" id="vizSettings" hidden>
        <div class="viz-settings__header">
          <span class="viz-settings__title">Settings</span>
          <button class="viz-settings__close" id="closeVizSettings" type="button" aria-label="Close settings">&#x2715;</button>
        </div>
        <div class="viz-settings__group">
          <label class="viz-settings__label">
            <span>Audio Reactivity</span>
            <span class="viz-settings__value" id="reactivityValue">100%</span>
          </label>
          <input type="range" id="vizReactivity" min="0" max="100" value="100" step="5" class="viz-settings__slider" />
          <div class="viz-settings__hint">How much audio affects the environment visuals</div>
        </div>
      </div>

      <!-- Playlist Modal -->
      <div class="playlist-modal" id="playlistModal" role="dialog" aria-modal="true" aria-labelledby="playlistModalTitle" hidden>
        <div class="playlist-modal__backdrop" id="playlistBackdrop"></div>
        <div class="playlist-modal__content">
          <header class="playlist-modal__header">
            <h2 id="playlistModalTitle" class="playlist-modal__title">Library</h2>
            <div class="playlist-modal__actions">
              <button class="modal-btn" id="addBtn" type="button">ADD</button>
              <button class="modal-btn modal-btn--danger" id="clearBtn" type="button">CLR</button>
            </div>
            <button class="playlist-modal__close" id="closePlaylistBtn" type="button" aria-label="Close playlist">
              &#x2715;
            </button>
          </header>

          <div class="playlist-modal__search">
            <input id="filterInput" type="search" placeholder="Search tracks..." autocomplete="off" aria-label="Search tracks" />
            <input id="filePicker" type="file" accept="audio/*,.mp3,.wav,.ogg,.m4a,.aac,.flac" multiple hidden />
          </div>

          <ol class="playlist-modal__list wa-list" id="playlist" aria-label="Track list"></ol>

          <div class="playlist-modal__empty" id="emptyState">
            <div class="empty-icon">&#x266B;</div>
            <div class="empty-title">No tracks yet</div>
            <div class="empty-text">
              Drag audio files here, click ADD, or add tracks to <code>tracks.js</code>
            </div>
          </div>

          <div class="playlist-modal__dropzone" id="dropzone" aria-hidden="true">
            Drop audio files to add
          </div>
        </div>
      </div>

    </main>

    <!-- Keep a real media element in the DOM for best mobile behavior -->
    <audio id="playerAudio" preload="metadata" crossorigin="anonymous" playsinline style="display:none"></audio>

    <script src="./tracks.js"></script>
    <script src="./models.js"></script>
    <script src="./themes.js"></script>
    <script src="./track-scenes.js"></script>
    <script src="./environments.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
